<html>
  <body>
    <canvas id="canvas" height="500" width="500"></canvas>

    <script type="text/javascript" src='https://code.jquery.com/jquery-2.1.1.min.js'></script>
    <script type="text/javascript">
      canvas = document.getElementById("canvas");
      ctx = canvas.getContext("2d");

      ctx.lineWidth = 4;

      ctx.strokeStyle = "rgba(255, 255, 255, 1.0)";
      ctx.beginPath();
      ctx.fillRect(0, 0, 500, 500);
      ctx.fill();

      var angle = Math.PI/2;
      var angleInc = Math.PI/80;
      var count = 0
      var colors = [0, 0, 0]
      var size = 300
      var x0 = 250;
      var y0 = 250 - size/2;
      var x1 = 250 - size/2;
      var y1 = 250;
      var ratio= 2/3;

      var leftPointX = 0
      var leftPointY = 250
      var rightPointX = 500 - leftPointX
      var rightPointY = leftPointY
      var xratio = 0.9

      function f(x){
        return parseInt(255*Math.sin(x*Math.PI))
      }

      function drawArcAtAngle(ctx, angle){
        ctx.beginPath();

        ctx.moveTo(x0, y0);
        xA = x0 + Math.cos(angle)*size*ratio
        xB = xA
        yA = y0
        yB = y0 + size
        ctx.bezierCurveTo(xA, yA ,xB, yB, x0, y0+size);
        ctx.stroke();
      }

      function drawVArcAtAngle(ctx, angle){
        ctx.beginPath();

        ctx.moveTo(x1, y1);
        xA = x1;
        xB = x1 + size;
        yA = y1 + Math.cos(angle)*size*ratio;
        yB = yA
        ctx.bezierCurveTo(xA, yA ,xB, yB, x1+size, y1);
        ctx.stroke();
      }

      function line(ctx, x1, y1, x2, y2){
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
      }

      function drawCube(ctx, angle, size){
        var backdelta = size/2/(x0-rightPointX)*(y0-rightPointY)
        _angle = angle % Math.PI/2

        //vline1
        ctx.beginPath();

        var x1 = 250 + Math.sin(_angle) * size/2
        delta = (x1-x0)*1.0/(x0-rightPointX)*(y0-rightPointY)
        var y1 = y0 + delta
        y2 = y0 - delta + size

        ctx.moveTo(x1, y1);
        ctx.lineTo(x1, y2);
        ctx.stroke();

        //vline2
        ctx.beginPath();
        x2 = 250 + Math.sin(_angle+3*Math.PI/2) * size/2
        delta = (x2-x0)*1.0/(x0-leftPointX)*(y0-leftPointY)
        y3 = y0 + delta
        y4 = y0 - delta + size

        ctx.moveTo(x2, y3);
        ctx.lineTo(x2, y4);
        ctx.stroke();

        //vline3
        ctx.beginPath();
        x3 = 250 + Math.sin(_angle+Math.PI) * size/2
        delta = (x3-x0+size/2)*1.0/(x0-size/2-rightPointX)*(y0 + backdelta - rightPointY)
        y5 = y0 + delta + backdelta
        y6 = y0 - delta - backdelta + size
        ctx.moveTo(x3, y5);
        ctx.lineTo(x3, y6);
        ctx.stroke();

        //vline4
        ctx.beginPath();
        x4 = 250 + Math.sin(_angle+Math.PI/2) * size/2
        delta = (x4-x0-size/2)*1.0/(x0+size/2-leftPointX)*(y0 + backdelta - leftPointY)
        y7 = y0 + backdelta + delta
        y8 = y0 - delta - backdelta + size
        ctx.moveTo(x4, y7);
        ctx.lineTo(x4, y8);
        ctx.stroke();

        //hlines
        ctx.beginPath();

        line(ctx, x1, y1, x2, y3)
        line(ctx, x1, y2, x2, y4)
        line(ctx, x1, y1, x4, y7)
        line(ctx, x1, y2, x4, y8)
        line(ctx, x3, y5, x2, y3)
        line(ctx, x3, y6, x2, y4)
        line(ctx, x3, y5, x4, y7)
        line(ctx, x3, y6, x4, y8)
      }

      function draw(e){
        if(e && e.keyCode && e.keyCode != 32) return

        ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
        ctx.fillRect(0, 0, 500, 500);

        count ++;

        x = (count % 100) / 100
        red = f(x)
        green = f((x+1/3) % 1)
        blue = f((x+2/3) % 1)

        ctx.strokeStyle = "rgba("+red+", "+green+", "+blue+", 0.7)";
        // drawArcAtAngle(ctx, angle)
        // drawArcAtAngle(ctx, angle+Math.PI)
        // drawArcAtAngle(ctx, angle+Math.PI/2)
        // drawArcAtAngle(ctx, angle-Math.PI/2)
        var foo = 0;
        while(foo < 2*Math.PI){
          drawVArcAtAngle(ctx, angle+foo)
          drawArcAtAngle(ctx, angle+foo)
          foo += Math.PI/3
        }

        // drawCube(ctx, angle, size)

        angle = angle + angleInc

        if(angle > 2*Math.PI){
          angle -= 2*Math.PI
        }
        requestAnimationFrame(draw)
      }
      draw()
      $('body').keyup(draw)

    </script>
  </body>
</html>
